<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">Loading...</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <!-- Reuse member portal styles -->
  <link rel="stylesheet" href="/styles/bundle.css?v=20251217k">

  <!-- Admin-specific styles -->
  <link rel="stylesheet" href="/admin/styles/admin.css?v=20260122a">

  <!-- Template editor styles -->
  <link rel="stylesheet" href="/styles/components/template-editor.css?v=20260110a">
</head>
<body class="authenticated admin">
  <!-- Navigation component inserted here -->

  <!-- Page Content -->
  <div class="page__container">
    <!-- Templates List -->
    <div class="card">
      <div class="card__header">
        <h2 class="card__title" id="templates-title">Loading...</h2>
        <button class="btn btn--primary" id="create-template-btn">Loading...</button>
      </div>

      <div id="templates-loading" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Hle√∞ sni√∞m√°tum...</p>
      </div>

      <div id="templates-empty" class="empty-state u-hidden">
        <p id="templates-empty-text">Loading...</p>
        <button class="btn btn--primary" id="create-first-template-btn">Loading...</button>
      </div>

      <table class="data-table u-hidden" id="templates-table">
        <thead>
          <tr>
            <th id="th-name">Loading...</th>
            <th id="th-subject">Loading...</th>
            <th id="th-type">Loading...</th>
            <th id="th-language">Loading...</th>
            <th id="th-actions">Loading...</th>
          </tr>
        </thead>
        <tbody id="templates-tbody">
          <!-- Templates will be inserted here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Template Editor Modal (Enhanced with AI + Preview) -->
  <div class="modal-overlay u-hidden" id="template-modal">
    <div class="modal modal--xxl">
      <div class="modal__header">
        <h2 class="modal__title" id="modal-title">Loading...</h2>
        <div class="modal__header-actions">
          <button class="modal__fullscreen" id="modal-fullscreen" title="Fullskj√°r">‚õ∂</button>
          <button class="modal__close" id="modal-close">&times;</button>
        </div>
      </div>

      <div class="modal__body template-editor">
        <div class="template-editor__main">
          <!-- Form -->
          <div class="template-editor__form">
            <form id="template-form">
              <input type="hidden" id="template-id">

              <div class="form-group">
                <label for="template-name" id="label-name">Loading...</label>
                <input type="text" id="template-name" class="form-input" required>
              </div>

              <div class="form-group">
                <label for="template-subject" id="label-subject">Loading...</label>
                <input type="text" id="template-subject" class="form-input" required>
              </div>

              <div class="form-row">
                <div class="form-group form-group--half">
                  <label for="template-type" id="label-type">Loading...</label>
                  <select id="template-type" class="form-select" required>
                    <option value="transactional" id="opt-transactional">Loading...</option>
                    <option value="broadcast" id="opt-broadcast">Loading...</option>
                  </select>
                </div>
                <div class="form-group form-group--half">
                  <label for="template-language" id="label-language">Loading...</label>
                  <select id="template-language" class="form-select" required>
                    <option value="is" id="opt-lang-is">Loading...</option>
                    <option value="en" id="opt-lang-en">Loading...</option>
                  </select>
                </div>
              </div>

              <div class="form-group template-editor__body-group">
                <label for="template-body" id="label-body">Loading...</label>
                <textarea id="template-body" class="form-textarea" required></textarea>
                <div class="template-editor__variables-hint">
                  Breytur: <code>{{ member.name }}</code>, <code>{{ member.first_name }}</code>, <code>{{ member.email }}</code>, <code>{{ member.kennitala }}</code>, <code>{{unsubscribe_url}}</code>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Bottom: Preview -->
        <div class="template-editor__preview" id="template-preview">
          <div class="preview__header">
            <h4>Forsko√∞un</h4>
            <span class="preview__note">Breytur s√Ωndar me√∞ s√Ωnid√∂gnum</span>
            <button class="preview__open-window" id="preview-open-window" title="Opna √≠ n√Ωjum glugga">‚ßâ</button>
            <button class="preview__toggle" id="preview-toggle" title="Fela/S√Ωna">‚àí</button>
          </div>
          <div class="preview__content">
            <iframe id="preview-iframe" sandbox="allow-same-origin" title="Forsko√∞un"></iframe>
          </div>
        </div>

        <!-- Floating AI Assistant Toggle Button -->
        <button class="assistant__fab" id="assistant-fab" title="AI A√∞sto√∞">‚ú®</button>

        <!-- Floating AI Assistant Panel -->
        <div class="template-editor__assistant template-editor__assistant--hidden" id="ai-assistant">
          <div class="assistant__header">
            <h3>AI A√∞sto√∞</h3>
            <button class="assistant__toggle" id="assistant-toggle" title="Loka">√ó</button>
          </div>
          <div class="assistant__quick-actions" id="assistant-quick-actions">
            <button type="button" class="assistant__quick-btn" data-action="socialist">‚úä S√≥s√≠alistasni√∞</button>
            <button type="button" class="assistant__quick-btn" data-action="format">üé® Sn√≠√∞a</button>
            <button type="button" class="assistant__quick-btn" data-action="list">üìã Listi</button>
            <button type="button" class="assistant__quick-btn" data-action="variables">‚ùì Breytur</button>
          </div>
          <div class="assistant__messages" id="assistant-messages">
            <div class="assistant__message assistant__message--assistant">
              H√¶! √âg get hj√°lpa√∞ √æ√©r a√∞ <strong>sn√≠√∞a</strong> textann me√∞ fallegu HTML √∫tliti. √âg breyti ekki or√∞unum - bara skipulaginu og √∫tlitinu.
            </div>
          </div>
          <div class="assistant__input">
            <input type="text" id="assistant-input" placeholder="Spur√∞u AI..." autocomplete="off">
            <button type="button" id="assistant-send">Senda</button>
          </div>
        </div>
      </div>

      <div class="modal__footer">
        <button class="btn btn--secondary" id="modal-cancel">Loading...</button>
        <button class="btn btn--primary" id="modal-save">Loading...</button>
      </div>
    </div>
  </div>

  <script type="module" src="/admin/email/js/templates-list.js?v=20260109p"></script>

  <!-- Initialize Navigation Component -->
  <script type="module">
    import { initNavHeader, NAV_CONFIGS } from '../../../ui/components/navigation-bar.js?v=20251217';
    await initNavHeader(NAV_CONFIGS.adminEmail);
  </script>

</body>
</html>
