<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Migrate Events to Firestore</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #1976d2;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .log {
      margin-top: 20px;
      padding: 15px;
      background: #f0f0f0;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .success { color: #2e7d32; }
    .error { color: #d32f2f; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Migrate Events to Firestore</h1>
    <p>This will add 3 Facebook events to the Firestore events collection.</p>

    <button id="migrateBtn" onclick="migrateEvents()">Migrate Events</button>

    <div id="log" class="log"></div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDlGQ7fZ3tEsKhB7FtYvF8zq_0w2xjKxE4",
      authDomain: "ekklesia-prod-10-2025.firebaseapp.com",
      projectId: "ekklesia-prod-10-2025",
      storageBucket: "ekklesia-prod-10-2025.firebasestorage.app",
      messagingSenderId: "521240388393",
      appId: "1:521240388393:web:a74b98e3c9e9f9c9e3c9e9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    function log(message, type = '') {
      const logEl = document.getElementById('log');
      const span = document.createElement('span');
      span.className = type;
      span.textContent = message + '\n';
      logEl.appendChild(span);
      logEl.scrollTop = logEl.scrollHeight;
    }

    window.migrateEvents = async function() {
      const btn = document.getElementById('migrateBtn');
      btn.disabled = true;
      document.getElementById('log').innerHTML = '';

      log('ðŸš€ Starting event migration...\n');

      // Check if user is authenticated
      if (!auth.currentUser) {
        log('âŒ ERROR: You must be logged in to migrate events.', 'error');
        log('Please login first at /members-area/dashboard.html', 'error');
        btn.disabled = false;
        return;
      }

      log(`Authenticated as: ${auth.currentUser.email || auth.currentUser.uid}`);
      log('');

      const events = [
        {
          title: 'MÃ¡lÃ¾ing um sveitarstjÃ³rnarmÃ¡l',
          date: Timestamp.fromDate(new Date('2025-11-01T10:00:00+00:00')),
          endDate: Timestamp.fromDate(new Date('2025-11-01T14:30:00+00:00')),
          description: 'Opinn fundur um sveitastjÃ³rnarmÃ¡l Ã¾ar sem allir fÃ¡ tÃ¦kifÃ¦ri til aÃ° segja sÃ­na skoÃ°un og heyra skoÃ°un annara.\n\nDagskrÃ¡:\nâ€¢ FullrÃºar frÃ¡ svÃ¦Ã°isfÃ©lÃ¶gum sÃ³sÃ­alista segir frÃ¡ sinni sÃ½n Ã¡ sveitastjÃ³rnarmÃ¡lum\nâ€¢ HlÃ©\nâ€¢ Almennar umrÃ¦Ã°ur um sveitastjÃ³rnarmÃ¡l Ã¾ar sem fÃ©lagsmenn fÃ¡ aÃ° segja sÃ­na skoÃ°un\nâ€¢ Kaffi og lÃ©ttar veitingar Ã­ boÃ°i',
          location: 'Hverfisgata 105, 101 ReykjavÃ­k',
          status: 'upcoming',
          organizers: ['SÃ³sÃ­alistaflokkur Ãslands'],
          createdAt: Timestamp.now(),
          updatedAt: Timestamp.now()
        },
        {
          title: 'TÃ¶lum um hÃºsnÃ¦Ã°ismÃ¡l',
          date: Timestamp.fromDate(new Date('2025-09-25T20:00:00+00:00')),
          endDate: Timestamp.fromDate(new Date('2025-09-25T21:30:00+00:00')),
          description: 'JÃ³n Ferdinand Estherarson fjallar um hÃºsnÃ¦Ã°ismÃ¡lin. HÃºsnÃ¦Ã°ismÃ¡l eru Ã­ dag eitt stÃ¦rsta verkefniÃ° sem unga fÃ³lkiÃ°, lÃ¡glaunafÃ³lk og efnaminni eru aÃ° takast Ã¡ viÃ°. VerkefniÃ° er alÃ¾jÃ³Ã°legt, en hÃ©r Ã¡ Ãslandi er Ã¾aÃ° engu aÃ° sÃ­Ã°ur einstakt. HvaÃ° er til rÃ¡Ã°a? Og hvaÃ° getur rÃ³ttÃ¦kur stjÃ³rnmÃ¡laflÃ³kkur gert til aÃ° bjarga Ã¾eim sem Ã­ vandrÃ¦Ã°um eru?\n\nKomdu og tÃ¶kum Ã¾etta saman! Ã hÃºsakynnum SÃ³sÃ­alistaflokks Ãslands, HverfisgÃ¶tu 105, Rvk. og Ã¡ zoom.',
          location: 'SÃ³sÃ­alistaflokkur Ãslands, HverfisgÃ¶tu 105',
          onlineLink: 'https://zoom.us/j/example',
          status: 'upcoming',
          organizers: ['Birna GunnlaugsdÃ³ttir', 'Markus Candi'],
          createdAt: Timestamp.now(),
          updatedAt: Timestamp.now()
        },
        {
          title: 'FÃ©lagsfundur OktÃ³ber 2025',
          date: Timestamp.fromDate(new Date('2025-10-25T10:30:00+00:00')),
          endDate: Timestamp.fromDate(new Date('2025-10-25T12:00:00+00:00')),
          description: 'FÃ©lagsfundur SÃ³sÃ­alistaflokks Ãslands.\n\nHÃºsiÃ° opnar klukkan 10:30 og fundurinn hefst stundvÃ­slega klukkan 11:00. BoÃ°iÃ° var upp Ã¡ aÃ° taka Ã¾Ã¡tt Ã­ gegnum Zoom.\n\nDagskrÃ¡:\n1. FramkvÃ¦mdastjÃ³rn segir frÃ¡ starfinu\n2. MÃ¡lefnastjÃ³rn segir frÃ¡ starfinu\n3. KosningastjÃ³rn segir frÃ¡ starfinu\n4. Sagt frÃ¡ starfi svÃ¦Ã°isfÃ©laga\n5. Ã–nnur mÃ¡l\n\nLÃ©ttar veitingar voru Ã­ boÃ°i.',
          location: 'Hverfisgata 105, 101 ReykjavÃ­k',
          status: 'past',
          organizers: ['SÃ³sÃ­alistaflokkur Ãslands'],
          createdAt: Timestamp.now(),
          updatedAt: Timestamp.now()
        }
      ];

      const eventsRef = collection(db, 'events');
      let successCount = 0;
      let errorCount = 0;

      for (const event of events) {
        try {
          const docRef = await addDoc(eventsRef, event);
          log(`âœ“ Added: "${event.title}"`, 'success');
          log(`  ID: ${docRef.id}`, 'success');
          log(`  Status: ${event.status}`);
          log('');
          successCount++;
        } catch (error) {
          log(`âœ— Failed: "${event.title}"`, 'error');
          log(`  Error: ${error.message}`, 'error');
          log('');
          errorCount++;
        }
      }

      // Verify
      try {
        const snapshot = await getDocs(eventsRef);
        log('â”'.repeat(50));
        log(`âœ… Migration complete!`, 'success');
        log(`   Successfully added: ${successCount} events`, 'success');
        if (errorCount > 0) {
          log(`   Errors: ${errorCount}`, 'error');
        }
        log(`   Total events in Firestore: ${snapshot.size}`);
        log('');
        log('Next steps:');
        log('1. Update events.js to fetch from Firestore');
        log('2. Remove hardcoded events from events.js');
        log('3. Deploy changes');
      } catch (error) {
        log(`Error verifying: ${error.message}`, 'error');
      }

      btn.disabled = false;
    };
  </script>
</body>
</html>
